require.config({
    // baseUrl: '/static/',
    
    shim: {
        'tool':['jquery'],
        'pages':['jquery'],
        'ueditor':['ueditorConfig', 'zhCn']
    },
    paths: {
        'tool' : 'js/tool',
        'pages': 'js/pages',
        "ueditorConfig":"plugins/ueditor1_4_3_3-utf8/ueditor.config",
        "ueditor":"plugins/ueditor1_4_3_3-utf8/ueditor.all.min",
        "zhCn":"plugins/ueditor1_4_3_3-utf8/lang/zh-cn/zh-cn",
        "ZeroClipboard": "plugins/ueditor1_4_3_3-utf8/third-party/zeroclipboard/ZeroClipboard", //主要是加这句话
        "mobileSelect":"plugins/mobileSelect/mobileSelect"
        // var jwt = require(“jsonwebtoken”);
    },
});
define('portal', ['jquery','layer'], function($,layer) {
    function getWeChatPayResult(out_trade_no, callback) {
        $.ajax({
            url: "/pay/wechat/order",
            type: "GET",
            data: {'out_trade_no': out_trade_no},
            dataType: "json",
            contentType: "application/json; charset=UTF-8",
            success: function (result) {
                callback(result);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(XMLHttpRequest.status + ' ' + XMLHttpRequest.readyState + ' ' + textStatus, 'error');
            }
        });
    }
    /* 手机端顶部导航收缩*/
    function navbarToggler(){
        var isShow=!$(".navbar-collapse").hasClass("shows");
        var width=document.body.clientWidth;
        var document_height=window.screen.availHeight;
        $(".navbar-collapse").removeClass("addAnimation")
        $(".navbar-collapse").removeClass("removeAnimation")
        if(width<=768){
            if(isShow){
                var navbarSpanHt=$(".navbar-span").get(0).offsetHeight;
                $(".navbar-collapse").css({display:"block",height:"calc(100vh - "+navbarSpanHt+"px)",top:navbarSpanHt+"px"});
                $(".navbar-collapse").addClass("shows addAnimation")
                layer.msg('12',{scrollbar:false,time:0,shadeClose:true,skin:"navbarlay"});
            }
            else{
                $(".navbar-collapse").removeClass("shows")
                $(".navbar-collapse").addClass("removeAnimation")
                layer.closeAll();
            }
        }
    }
     /*去除""或undefind null*/
    function checkNull(obj) {
        if (obj === null || typeof (obj) === "undefined") {
            return "";
        }
        var type = (typeof (obj)).toLowerCase();
        if (type === "string" && (obj.toString()).replace(/(^\s*)|(\s*$)/g, "") === "") {
            return "";
        }
        return obj;
    }
    //生成时间戳
    function Timestamp() {
        var datetime = Date.parse(new Date());
        return datetime / 1000;
    }
    
    /*
    页面div中显示信息
    *
    显示方式
    showmsg({
    msg:"",  //显示的信息,
    isbtn:"",   //是否显示按钮,
    url:"",//点击按钮时的跳转链接 为空时为刷新,
    icon:"",//错误图片,
    btntext:"",//按钮文字,
    classname:"",//样式名
    })
    */

    function showmsg(str) {
        var icon_fontSize=str.iconFontSize?str.iconFontSize:"6rem";
        var msg = checkNull(str.msg)==""?"系统错误，请联系管理员":str.msg;
        var url = checkNull(str.url);
        var btntext = checkNull(str.btntext)==""?"立即刷新":str.btntext;
        var showimg = checkNull(str.showimg)==""?"../images/mobile/Datafailed.png":str.showimg;
        var isbtn = checkNull(str.isbtn);
        var classname = checkNull(str.classname);
        var backurl=url ==""? "1":"2";
        if (isbtn == "") {
            isbtn = false;
        }
        else if (isbtn != true && isbtn != false) {
            isbtn = false;
        }
        var showmsg = "";
        var btns = backurl == "1" ? "<button class='nonetwork_btn' onTouchEnd=reload()>" + btntext + "</button>" : "<button class='nonetwork_btn' onTouchEnd=linkto('" + url + "')>" + btntext + "</button>"
        var isshowbtn = isbtn ? btns : "";
        showmsg += "<div class='nonetwork mt3_r mlr1_r" + classname + "'>";
        showmsg += "<div class='nonetworkwarp'>";
        showmsg += '<div class="tc"><i class="myIconfont" style="font-size:'+icon_fontSize+'">&#xe61b;</i></div>'
        showmsg += '<p class="tc">' + msg + '</p>';
        showmsg += isshowbtn;
        showmsg += "</div>";
        showmsg += "</div>";
        return showmsg;
    }

    /**显示template模板 */
    function showtemp(data,listTmpl, id, callback){
        var datas=data?data:[];
        var callback=callback?callback:function(){};
        if(datas.length==0){
            $(id).html(showmsg({msg:"没有检索到数据"}))
        }else{
            var templates=template(listTmpl, {list:data});
            $(id).html(templates)
        }
    }
    
    
    /* ----------------- 通用ajax ----------------- */
    /**
     *  ajaxUrl：     ajax的URl
     *  returnData：  ajajx传送的参数
     *  types：       ajajx 类型 默认为post
     *  async：       使用同步的方式, true：为异步方式 false：同步  默认true
     *  isparse：     是否使用 JSON.parse(JSON.stringify())转换 true:使用, false:不使用 默认true
     *  dataType      数据类型 默认json
     *  contentType:  发送信息至服务器时内容编码类型   application/x-www-form-urlencoded 、application/json，默认 application/x-www-form-urlencoded 
     *  showload:     是否显示正在加载图片 默认false
     *  closeLoad:    是否在ajax成功或失败后关闭加载图片 默认true
     *  loadbox:      正在加载在哪个div显示  为空时直接弹出
     *  loadtime:     加载延迟时间 默认320秒
     *  currentPages：当前页数 默认1
     *  disabelBox：  点击后禁用的按钮
     *  success：     成功后的回调函数
     *  erro：        失败后的回调函数
     */
    function ajaxFns(success,ajaxUrl,params){
        var defaultParams = {
            returnData:{},
            types:"post",
            async:true,
            isparse:true,
            dataType:"json",
            contentType:"application/x-www-form-urlencoded",
            showload:false, 
            closeLoad:true,
            loadbox:"", 
            loadtime:320, 
            currentPages:1,
            disabledBox:"",
            erro:function(){},
        }
        var settings = {};
        $.extend(settings,defaultParams,params);
        
        var returnData=settings.returnData;
        var types=settings.types;
        var async=settings.async;
        var isparse=settings.isparse;
        var dataType=settings.dataType;
        var contentType=settings.contentType;
        var showload=settings.showload;
        var closeLoad=settings.closeLoad;
        var loadbox=settings.loadbox;
        var loadtime=settings.loadtime;
        var currentPages=settings.currentPages;
        var disabledBox=settings.disabledBox;
        var erro=settings.erro;

        success=success?success:function(){};
        var ajaxurls=checkNull(ajaxUrl)!=""?ajaxUrl.indexOf("?")>=0?ajaxUrl+"&v1="+Timestamp():ajaxUrl+"?v1="+Timestamp():""; //ajax url
        var isload="true";; //是否正在加载数据
        var returnDatas=isparse?JSON.parse(JSON.stringify(returnData)):returnData;
            /* 显示正在加载 图标 */
            if(showload){
            setTimeout(function(){
                    if(isload=="true"){
                        if(loadbox==""){
                            layer.load(0, {
                            shadeClose: false,
                            shade: [0.1,"#333"] //0.1透明度的白色背景
                            }); //0代表加载的风格，支持0-2
                        }else{
                            $(loadbox).html('<span class="loadbox"><p class="layui-layer-content layui-layer-loading0"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop">&#xe63d;</i></p></span>')
                        }
                    }
                },loadtime)
            }
            disabledBox!=""?$(disabledBox).attr("disabled",true):"";  //禁用点击的按钮
            $.ajax({
                url: ajaxurls,
                data: returnDatas,
                type: types,
                async: async,
                dataType: dataType,
                contentType:contentType, 
                success: function (data) {
                    isload="false"; 
                    showload && closeLoad?layer.closeAll('loading'):"";
                    disabledBox!=""?$(disabledBox).attr("disabled",false):"";
                    success(data);

                },
                erro: function (XMLHttpRequest, textStatus, errorThrown) {
                    showload && closeLoad?layer.closeAll('loading'):"";   
                    disabledBox!=""?$(disabledBox).attr("disabled",false):"";
                    isload="false"; 
                    erro();
                }
            });
    }
    return {
        getWeChatPayResult: getWeChatPayResult,  // 获取微信支付结果
        navbarToggler: navbarToggler,
        checkNull:checkNull,
        ajaxFns:ajaxFns,
        showtemp:showtemp,
        showmsg:showmsg,
        // imgChange:imgChange,
    };
});

